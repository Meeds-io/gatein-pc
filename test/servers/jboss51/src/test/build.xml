<?xml version="1.0"?>
<project name="tomcat-integration-test" default="tests">

   <import file="${common.xml.file}"/>

   <!-- SYSTEM PROPERTIES -->
   <property environment="env"/>
   <property name="test.cargo.home" value="${env.JBOSS_5_1_0_HOME}"/>


   <!-- properties unique per app server -->
   <property name="test.server.name" value="JBoss"/>
   <property name="test.server.version" value="5.1"/>
   <property name="test.remote.server.name" value="RemoteJBoss_5_1"/>
   <property name="cargo.container.id" value="jboss51x"/>

   <target name="tests" unless="maven.test.skip">
      <antcall target="tests.common"/>
   </target>

   <target name="cargo.start" depends="__cargo.setup">

      <taskdef resource="cargo.tasks">
         <classpath>
            <pathelement path="${plugin_classpath}"/>
         </classpath>
      </taskdef>

      <cargo
              containerId="jboss51x"
              home="${test.cargo.home}"
              output="${cargo.log.dir}/cargo.${test.server.name}-${test.server.version}.server.log"
              log="${cargo.log.dir}/cargo.${test.server.name}-${test.server.version}.start.log"
              action="start"
              wait="${cargo.wait}">
         <sharedClasspath>
            <path refid="JBoss-5.1-shared"/>
         </sharedClasspath>
         <configuration home="${test.cargo.dir}">
            <property name="cargo.servlet.port" value="8080"/>
            <property name="cargo.logging" value="high"/>
            <property name="cargo.rmi.port" value="1099"/>
            <property name="cargo.jvmargs" value="-Duser.language=en ${cargo.debug}"/>
            <deployable type="war" file="${test.temp.lib}/JBoss-5.1/portlet-test.war"/>
            <file file="${target}/test-classes/config/context.xml" tofile="deploy/jbossweb.sar/context.xml" overwrite="true"/>
         </configuration>
      </cargo>
   </target>

   <target name="cargo.stop" depends="__cargo.setup">
      <cargo
              containerId="jboss51x"
              home="${test.cargo.home}"
              log="${cargo.log.dir}/cargo.${test.server.name}-${test.server.version}.shutdown.log"
              action="stop">
         <configuration home="${test.cargo.dir}"/>
      </cargo>
   </target>
</project>
